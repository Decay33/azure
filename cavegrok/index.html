<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CaveGrok</title>
  <link rel="stylesheet" href="style.css">
  <!-- Include the PayPal SDK (using your client ID) -->
  <script src="https://www.paypal.com/sdk/js?client-id=AWIS-jxfsiCJ0C5RpGJ91exuqeC_MJjSTwhnmPbPCSd3jDtGETC4RhrOon8Uo-s7N3j7z-Ml_Leleq-y&currency=USD"></script>
</head>
<body>
  <!-- Add consistent spacing to all main elements -->
  <div style="display: flex; flex-direction: column; gap: 10px; padding-top: 120px;">
    <!-- Instructions with updated content -->
    <div id="instructions">
      <h2>How to Play</h2>
      <p>
        Use the arrow keys to control your ship's movement. Press Space to lift off.
        Land gently on the platforms to progress through levels. The timer will give you a bonus
        if you land quickly and carefully.
      </p>
      <p>
        Watch out for:
        â€¢ Stalactites - They fall when you get close!
        â€¢ Acid pools - Avoid contact at all costs
        â€¢ Cave walls - Don't crash into them
      </p>
      <p>
        Collect gold coins for extra points and unlock special ships at Level 10 and Level 20!
        Press 'S' to switch between your unlocked ships.
      </p>
      <p style="color: #00ff00; font-weight: bold;">
        ðŸŽµ Press 'M' to toggle sound effects! ðŸŽµ
      </p>
    </div>

    <!-- Return Button - centered and original size -->
    <div style="text-align: center;">
      <a href="#" class="return-button" id="returnButton" style="display: inline-block;">Return to TheAiDemocracy.com</a>
    </div>

    <!-- Game Canvas -->
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <!-- Purchase Section - centered buttons -->
    <div id="purchaseSection" style="text-align: center;">
      <!-- This message will display if the ship is already unlocked -->
      <div id="alreadyPurchased" style="display: none;">
        <button class="unlock-button purchased">HOT Pink Ship Unlocked!</button>
      </div>
      
      <!-- Unlock Button (shown if not purchased) -->
      <button id="unlockButton" class="unlock-button">
        If you are Elon Musk, click here to unlock the HOT Pink ship!!
      </button>
      
      <!-- Purchase Panel (hidden by default) -->
      <div id="paypalContainer" style="display: none;">
        <div class="payment-info">
          <p>Base Price: $10.00</p>
          <label>
            Donate additional:
            <input type="number" id="extraAmount" value="0" min="0" step="1">
          </label>
          <p>Total: $<span id="totalAmount">10.00</span></p>
        </div>
        <div id="paypal-button-container"></div>
      </div>
    </div>

    <!-- Ship Showcase Section -->
    <div class="ship-showcase" style="padding: 15px; border: 1px solid #444; border-radius: 10px; background: rgba(0,0,0,0.3);">
      <h3 style="color: white; text-align: center; margin-bottom: 10px;">Available Ships</h3>
      <p style="color: #00ff00; text-align: center; font-size: 18px; margin-bottom: 10px; text-shadow: 0 0 10px rgba(0,255,0,0.5); font-weight: bold; letter-spacing: 1px;">
        âš¡ Press 'S' to switch between unlocked ships âš¡
      </p>
      
      <div style="display: flex; justify-content: space-around; flex-wrap: wrap; gap: 20px;">
        <!-- Hot Pink Ship Preview -->
        <div class="preview-container" style="text-align: center; position: relative;">
          <p style="color: white;">Preview of HOT Pink Ship:</p>
          <div id="hotPinkShipWrapper" style="position: relative; display: inline-block; margin: 10px 0;">
            <canvas id="shipCanvas" width="100" height="100" style="border: 2px solid #fff;"></canvas>
            <div id="hotPinkUnlockedBadge" style="display: none; position: absolute; top: -10px; right: -10px; background: #FF1493; color: white; border-radius: 50%; width: 25px; height: 25px; text-align: center; line-height: 25px; font-weight: bold; box-shadow: 0 0 5px rgba(255,255,255,0.7);">âœ“</div>
            <div id="unlockedText-hotpink" style="display: none; position: absolute; bottom: -5px; width: 100%; text-align: center; font-size: 11px; background: rgba(255, 20, 147, 0.8); color: white; padding: 2px 0; border-radius: 0 0 5px 5px;">UNLOCKED!</div>
          </div>
          <p style="color: #888; font-size: 14px;">(Unlock via purchase)</p>
        </div>
        
        <!-- Purple Ship Preview -->
        <div class="preview-container" style="text-align: center; position: relative;">
          <p style="color: white;">Preview of Purple Ship:</p>
          <div id="purpleShipWrapper" style="position: relative; display: inline-block; margin: 10px 0;">
            <canvas id="purpleShipCanvas" width="100" height="100" style="border: 2px solid #fff;"></canvas>
            <div id="purpleUnlockedBadge" style="display: none; position: absolute; top: -10px; right: -10px; background: #8A2BE2; color: white; border-radius: 50%; width: 25px; height: 25px; text-align: center; line-height: 25px; font-weight: bold; box-shadow: 0 0 5px rgba(255,255,255,0.7);">âœ“</div>
            <div id="unlockedText-purple" style="display: none; position: absolute; bottom: -5px; width: 100%; text-align: center; font-size: 11px; background: rgba(138, 43, 226, 0.8); color: white; padding: 2px 0; border-radius: 0 0 5px 5px;">UNLOCKED!</div>
          </div>
          <p style="color: #888; font-size: 14px;">(Unlock at Level 10)</p>
        </div>
        
        <!-- Golden Ship Preview -->
        <div class="preview-container" style="text-align: center; position: relative;">
          <p style="color: white;">Preview of Golden Ship:</p>
          <div id="goldenShipWrapper" style="position: relative; display: inline-block; margin: 10px 0;">
            <canvas id="goldenShipCanvas" width="100" height="100" style="border: 2px solid #fff;"></canvas>
            <div id="goldenUnlockedBadge" style="display: none; position: absolute; top: -10px; right: -10px; background: #FFD700; color: black; border-radius: 50%; width: 25px; height: 25px; text-align: center; line-height: 25px; font-weight: bold; box-shadow: 0 0 5px rgba(255,255,255,0.7);">âœ“</div>
            <div id="unlockedText-golden" style="display: none; position: absolute; bottom: -5px; width: 100%; text-align: center; font-size: 11px; background: rgba(255, 215, 0, 0.8); color: black; padding: 2px 0; border-radius: 0 0 5px 5px;">UNLOCKED!</div>
          </div>
          <p style="color: #888; font-size: 14px;">(Unlock at Level 20)</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Load Game Files -->
  <script src="sounds.js"></script>
  <script src="visual-effects.js"></script>
  <script src="levels.js"></script>
  <script src="walls.js"></script>
  <script src="game.js"></script>
  <script src="paypal.js"></script>
  
  <!-- Check purchase state on load and update purchase section -->
  <script>
    window.addEventListener('load', function(){
      if(localStorage.getItem('hotPinkShipUnlocked') === 'true'){
        // Hide unlock button and PayPal container, show purchased message.
        document.getElementById('unlockButton').style.display = 'none';
        document.getElementById('paypalContainer').style.display = 'none';
        document.getElementById('alreadyPurchased').style.display = 'block';
      }
    });
  </script>

  <!-- Updated Return Button Script -->
  <script>
    document.getElementById('returnButton').addEventListener('click', function(e) {
      e.preventDefault();
      // Try to close the window. If not permitted, redirect to the main site.
      if (window.close) {
        window.close();
        // If the tab remains open (because the browser disallowed window.close),
        // redirect after a short delay as a fallback.
        setTimeout(function() {
          if (!window.closed) {
            window.location.href = "https://www.theaidemocracy.com";
          }
        }, 100);
      } else {
        window.location.href = "https://www.theaidemocracy.com";
      }
    });
  </script>

  <!-- Update the preview text color to white -->
  <style>
    .preview-text, 
    .preview-container p, 
    .preview-container div {
      color: white !important;
    }
  </style>

  <script>
    // Initialize the ship preview canvas
    window.addEventListener('load', function() {
      const shipCanvas = document.getElementById('shipCanvas');
      if (shipCanvas) {
        const previewCtx = shipCanvas.getContext('2d');
        
        function drawHotPinkShipPreview() {
          // Clear canvas
          previewCtx.clearRect(0, 0, shipCanvas.width, shipCanvas.height);
          
          // Center the ship
          previewCtx.save();
          previewCtx.translate(shipCanvas.width/2, shipCanvas.height/2);
          
          // Scale to fit canvas
          let scale = Math.min(shipCanvas.width, shipCanvas.height) / 60;
          previewCtx.scale(scale, scale);
          
          // Hot Pink Ship - Sleek Racing Design (matching new in-game design)
          previewCtx.shadowColor = '#FF1493';
          previewCtx.shadowBlur = 8;
          
          // Main body - streamlined
          previewCtx.fillStyle = '#FF1493';
          previewCtx.beginPath();
          previewCtx.moveTo(0, -10);
          previewCtx.lineTo(10, -3);
          previewCtx.lineTo(7, 10);
          previewCtx.lineTo(-7, 10);
          previewCtx.lineTo(-10, -3);
          previewCtx.closePath();
          previewCtx.fill();
          
          // Side wings
          previewCtx.fillStyle = '#FF69B4';
          previewCtx.beginPath();
          previewCtx.moveTo(-10, 0);
          previewCtx.lineTo(-13, -5);
          previewCtx.lineTo(-7, 5);
          previewCtx.closePath();
          previewCtx.fill();
          
          previewCtx.beginPath();
          previewCtx.moveTo(10, 0);
          previewCtx.lineTo(13, -5);
          previewCtx.lineTo(7, 5);
          previewCtx.closePath();
          previewCtx.fill();
          
          // Cockpit - crystal-like
          previewCtx.shadowBlur = 0;
          previewCtx.fillStyle = '#FFAADD';
          previewCtx.beginPath();
          previewCtx.moveTo(0, -7);
          previewCtx.lineTo(4, -3);
          previewCtx.lineTo(0, 3);
          previewCtx.lineTo(-4, -3);
          previewCtx.closePath();
          previewCtx.fill();
          
          // Racing stripes
          previewCtx.strokeStyle = '#FFFFFF';
          previewCtx.lineWidth = 1;
          previewCtx.beginPath();
          previewCtx.moveTo(-5, -5);
          previewCtx.lineTo(5, -5);
          previewCtx.stroke();
          
          // Add sparkle animation
          if (Math.floor(Date.now() / 200) % 5 === 0) {
            previewCtx.fillStyle = '#FFFFFF';
            let sparkX = (Math.random() - 0.5) * 20;
            let sparkY = (Math.random() - 0.5) * 20;
            previewCtx.beginPath();
            previewCtx.arc(sparkX, sparkY, 1, 0, Math.PI * 2);
            previewCtx.fill();
          }
          
          // Add reduced engine flame animation
          let flameHeight = 3 + Math.sin(Date.now() / 100) * 1; // Reduced size
          let gradient = previewCtx.createLinearGradient(0, 10, 0, 10 + flameHeight);
          gradient.addColorStop(0, 'rgba(255, 255, 0, 0.6)'); // Reduced opacity
          gradient.addColorStop(0.6, 'rgba(255, 69, 0, 0.4)');
          gradient.addColorStop(1, 'rgba(255, 69, 0, 0)');
          
          previewCtx.fillStyle = gradient;
          previewCtx.beginPath();
          previewCtx.moveTo(-2, 10); // Narrower flame
          previewCtx.lineTo(0, 10 + flameHeight);
          previewCtx.lineTo(2, 10);
          previewCtx.closePath();
          previewCtx.fill();
          
          previewCtx.restore();
          
          // Request next animation frame
          requestAnimationFrame(drawHotPinkShipPreview);
        }
        
        // Start the animation
        drawHotPinkShipPreview();
      }
    });
  </script>

  <script>
    // Update preview rendering for purple and golden ships
    window.addEventListener('load', function() {
        // Purple ship preview
        const purpleCanvas = document.getElementById('purpleShipCanvas');
        if (purpleCanvas) {
            const purpleCtx = purpleCanvas.getContext('2d');
            
            function drawPurpleShipPreview() {
                purpleCtx.clearRect(0, 0, purpleCanvas.width, purpleCanvas.height);
                purpleCtx.save();
                purpleCtx.translate(purpleCanvas.width/2, purpleCanvas.height/2);
                
                // Scale to fit canvas
                let scale = Math.min(purpleCanvas.width, purpleCanvas.height) / 60;
                purpleCtx.scale(scale, scale);
                
                // Purple Ship - Mystical/Magical Design (matching new in-game design)
                purpleCtx.shadowColor = '#8A2BE2';
                purpleCtx.shadowBlur = 10;
                
                // Main body - hexagonal
                purpleCtx.fillStyle = '#8A2BE2';
                purpleCtx.beginPath();
                purpleCtx.moveTo(0, -10);
                purpleCtx.lineTo(7, -5);
                purpleCtx.lineTo(7, 5);
                purpleCtx.lineTo(0, 10);
                purpleCtx.lineTo(-7, 5);
                purpleCtx.lineTo(-7, -5);
                purpleCtx.closePath();
                purpleCtx.fill();
                
                // Energy cores on sides
                purpleCtx.shadowBlur = 0;
                purpleCtx.fillStyle = '#9370DB';
                purpleCtx.beginPath();
                purpleCtx.arc(-5, 0, 3, 0, Math.PI * 2);
                purpleCtx.fill();
                purpleCtx.beginPath();
                purpleCtx.arc(5, 0, 3, 0, Math.PI * 2);
                purpleCtx.fill();
                
                // Central crystal
                purpleCtx.fillStyle = '#DDA0DD';
                purpleCtx.beginPath();
                purpleCtx.moveTo(0, -5);
                purpleCtx.lineTo(3, 0);
                purpleCtx.lineTo(0, 5);
                purpleCtx.lineTo(-3, 0);
                purpleCtx.closePath();
                purpleCtx.fill();
                
                // Mystical runes
                purpleCtx.strokeStyle = '#E6E6FA';
                purpleCtx.lineWidth = 1;
                purpleCtx.beginPath();
                purpleCtx.arc(0, -3, 2, 0, Math.PI * 2);
                purpleCtx.stroke();
                purpleCtx.beginPath();
                purpleCtx.arc(0, 3, 2, 0, Math.PI * 2);
                purpleCtx.stroke();
                
                purpleCtx.restore();
                requestAnimationFrame(drawPurpleShipPreview);
            }
            drawPurpleShipPreview();
        }
        
        // Golden ship preview
        const goldenCanvas = document.getElementById('goldenShipCanvas');
        if (goldenCanvas) {
            const goldenCtx = goldenCanvas.getContext('2d');
            
            function drawGoldenShipPreview() {
                goldenCtx.clearRect(0, 0, goldenCanvas.width, goldenCanvas.height);
                goldenCtx.save();
                goldenCtx.translate(goldenCanvas.width/2, goldenCanvas.height/2);
                
                // Scale to fit canvas
                let scale = Math.min(goldenCanvas.width, goldenCanvas.height) / 60;
                goldenCtx.scale(scale, scale);
                
                // Golden Ship - Royal/Imperial Design (matching new in-game design)
                goldenCtx.shadowColor = '#FFD700';
                goldenCtx.shadowBlur = 12;
                
                // Main body - regal shape
                goldenCtx.fillStyle = '#FFD700';
                goldenCtx.beginPath();
                goldenCtx.moveTo(0, -10);
                goldenCtx.lineTo(8, -4);
                goldenCtx.lineTo(10, 3);
                goldenCtx.lineTo(5, 10);
                goldenCtx.lineTo(-5, 10);
                goldenCtx.lineTo(-10, 3);
                goldenCtx.lineTo(-8, -4);
                goldenCtx.closePath();
                goldenCtx.fill();
                
                // Crown-like top
                goldenCtx.shadowBlur = 0;
                goldenCtx.fillStyle = '#FFA500';
                goldenCtx.beginPath();
                goldenCtx.moveTo(-5, -10);
                goldenCtx.lineTo(-3, -13);
                goldenCtx.lineTo(0, -12);
                goldenCtx.lineTo(3, -13);
                goldenCtx.lineTo(5, -10);
                goldenCtx.lineTo(0, -7);
                goldenCtx.closePath();
                goldenCtx.fill();
                
                // Royal gems
                goldenCtx.fillStyle = '#FF4500';
                goldenCtx.beginPath();
                goldenCtx.arc(-3, -7, 1.5, 0, Math.PI * 2);
                goldenCtx.fill();
                goldenCtx.beginPath();
                goldenCtx.arc(3, -7, 1.5, 0, Math.PI * 2);
                goldenCtx.fill();
                
                // Gold trim
                goldenCtx.strokeStyle = '#FFFF88';
                goldenCtx.lineWidth = 1;
                goldenCtx.beginPath();
                goldenCtx.moveTo(-7, 0);
                goldenCtx.lineTo(7, 0);
                goldenCtx.stroke();
                
                goldenCtx.restore();
                requestAnimationFrame(drawGoldenShipPreview);
            }
            drawGoldenShipPreview();
        }
    });
  </script>

  <script>
    // Add script to show the unlocked indicators
    window.addEventListener('load', function() {
        // Check for unlocked ships
        if (localStorage.getItem('hotPinkShipUnlocked') === 'true') {
            document.getElementById('hotPinkUnlockedBadge').style.display = 'block';
            document.getElementById('unlockedText-hotpink').style.display = 'block';
            document.getElementById('shipCanvas').style.border = '3px solid #FF1493';
            document.getElementById('shipCanvas').style.boxShadow = '0 0 10px #FF1493';
        }
        
        if (localStorage.getItem('purpleShipUnlocked') === 'true') {
            document.getElementById('purpleUnlockedBadge').style.display = 'block';
            document.getElementById('unlockedText-purple').style.display = 'block';
            document.getElementById('purpleShipCanvas').style.border = '3px solid #8A2BE2';
            document.getElementById('purpleShipCanvas').style.boxShadow = '0 0 10px #8A2BE2';
        }
        
        if (localStorage.getItem('goldenShipUnlocked') === 'true') {
            document.getElementById('goldenUnlockedBadge').style.display = 'block';
            document.getElementById('unlockedText-golden').style.display = 'block';
            document.getElementById('goldenShipCanvas').style.border = '3px solid #FFD700';
            document.getElementById('goldenShipCanvas').style.boxShadow = '0 0 10px #FFD700';
        }
    });
  </script>
</body>
</html>

