<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Members Hub - The AI Democracy</title>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;500;600;700&family=Exo+2:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
  <div class="scanline"></div>
  <div class="circuit-lines">
    <div class="circuit-line horizontal-line" style="top: 15%; left: 5%; width: 150px;"></div>
    <div class="circuit-line vertical-line" style="top: 30%; left: 10%; height: 120px;"></div>
    <div class="circuit-dot" style="top: 30%; left: 10%;"></div>
    <div class="circuit-line horizontal-line" style="top: 75%; right: 5%; width: 200px;"></div>
    <div class="circuit-line vertical-line" style="top: 60%; right: 20%; height: 150px;"></div>
    <div class="circuit-dot" style="top: 60%; right: 20%;"></div>
    <div class="circuit-line horizontal-line" style="top: 40%; right: 30%; width: 100px;"></div>
    <div class="circuit-dot" style="top: 40%; right: 30%;"></div>
  </div>

  <nav class="nav-bar">
    <a href="/" class="nav-logo"><span class="nav-logo-the">THE</span>AI<span>Democracy</span></a>
    <div class="nav-links">
      <a href="/" class="nav-link">Home</a>
      <a href="/#game-list" class="nav-link">Games</a>
      <a href="/#tools" class="nav-link">Tools</a>
      <a href="/#contact" class="nav-link">Contact</a>
      <a href="/privacy.html" class="nav-link">Privacy</a>
    </div>
    <div class="nav-links nav-auth">
      <a id="sign-out-link" class="nav-link" href="/.auth/logout?post_logout_redirect_uri=/">Sign Out</a>
    </div>
  </nav>

  <div class="auth-banner" id="auth-banner">
    <span id="auth-status">Loading your profile...</span>
  </div>

  <main class="members-main">
    <header>
      <h1>Members Command Center</h1>
      <p class="ai-statement">This area gives you early looks at upcoming AI experiments, community drops, and progress snapshots tailored to members.</p>
    </header>

    <section class="members-card">
      <h2>Your Identity</h2>
      <dl class="member-meta">
        <div>
          <dt>Name</dt>
          <dd id="member-name">—</dd>
        </div>
        <div>
          <dt>Email</dt>
          <dd id="member-email">—</dd>
        </div>
        <div>
          <dt>Provider</dt>
          <dd id="member-provider">—</dd>
        </div>
        <div>
          <dt>Roles</dt>
          <dd id="member-roles">—</dd>
        </div>
      </dl>
    </section>

    <section class="members-card">
      <h2>Raw Principal Payload</h2>
      <pre id="principal-json">Fetching principal...</pre>
    </section>

    <section class="members-card">
      <h2>Next Steps</h2>
      <ul class="members-actions">
        <li>Test drive upcoming game builds before they hit the public hub.</li>
        <li>Track engagement stats powered by your secure EasyAuth identity.</li>
        <li>Use the contact form on the home page to pitch tools or games—we prioritize member submissions.</li>
      </ul>
    </section>
  </main>

  <footer>
    <p>Powered by Advanced AI Technology - Your member data stays protected behind Azure Static Web Apps EasyAuth.</p>
    <div class="footer-links">
      <a href="/privacy.html" class="footer-link">Privacy Policy</a>
      <a href="/#contact" class="footer-link">Contact Us</a>
      <a href="/.auth/logout?post_logout_redirect_uri=/" class="footer-link">Sign Out</a>
    </div>
  </footer>

  <script>
    async function getMe() {
      try {
        const response = await fetch('/.auth/me', { credentials: 'include' });
        if (!response.ok) {
          return null;
        }
        const payload = await response.json();
        return payload?.clientPrincipal || null;
      } catch (_error) {
        return null;
      }
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const principal = await getMe();
      const authStatus = document.getElementById('auth-status');
      const nameEl = document.getElementById('member-name');
      const emailEl = document.getElementById('member-email');
      const providerEl = document.getElementById('member-provider');
      const rolesEl = document.getElementById('member-roles');
      const payloadEl = document.getElementById('principal-json');

      if (!principal) {
        authStatus.textContent = 'Your session expired. Please sign in again.';
        nameEl.textContent = emailEl.textContent = providerEl.textContent = rolesEl.textContent = '—';
        payloadEl.textContent = 'No principal payload available.';
        return;
      }

      const display = principal.userDetails || principal.userId || 'Player';
      authStatus.innerHTML = `Welcome back, <strong>${display}</strong>.`;
      nameEl.textContent = display;
      emailEl.textContent = principal.claims?.find(c => c.typ === 'email' || c.typ === 'emails')?.val || principal.userDetails || '—';
      providerEl.textContent = principal.identityProvider || 'Google';
      rolesEl.textContent = (principal.userRoles || []).join(', ');
      payloadEl.textContent = JSON.stringify(principal, null, 2);
    });
  </script>
</body>
</html>
